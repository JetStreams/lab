<!DOCTYPE html>
<html lang="en">
    <head>
        <title>three.js webgl - STL</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                font-family: Monospace;
                background-color: #000000;
                margin: 0px;
                overflow: hidden;
            }

            #info {
                color: #fff;
                position: absolute;
                top: 10px;
                width: 100%;
                text-align: center;
                z-index: 100;
                display:block;

            }

            a { color: skyblue }
            .button { background:#999; color:#eee; padding:0.2em 0.5em; cursor:pointer }
            .highlight { background:orange; color:#fff; }

            span {
                display: inline-block;
                width: 60px;
                float: left;
                text-align: center;
            }

        </style>
    </head>
    <body>
        <div id="info">
            <a href="http://threejs.org" target="_blank">three.js</a> - Model of Jetstreams
        </div>

        <script src="http://threejs.org/build/three.min.js"></script>

        <script src="http://threejs.org/examples/js/loaders/STLLoader.js"></script>
        <script src="http://threejs.org/examples/js/wip/TypedGeometry.js"></script>

        <script src="http://threejs.org/examples/js/Detector.js"></script>
        <script src="http://threejs.org/examples/js/libs/stats.min.js"></script>

        <script>

            if (!Detector.webgl)
                Detector.addGetWebGLMessage();

            var container, stats;
            var camera, scene, renderer, light, mesh;

            init();
            animate();

            function init() {
                
                //create and add container
                container = document.createElement('div');
                document.body.appendChild(container);

                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 15);
                camera.position.z  = 10;

                scene = new THREE.Scene();
                scene.fog = new THREE.Fog(0x72645b, 2, 15);
                
                loadMesh();

                // Lights
                scene.add(new THREE.AmbientLight(0xffffff));

                addShadowedLight(5, 5, 5, 0xffffff, 1.5);

                // renderer
                renderer = new THREE.WebGLRenderer({antialias: true});
                renderer.setSize(window.innerWidth, window.innerHeight);

                renderer.setClearColor(scene.fog.color, 1);

                renderer.gammaInput = true;
                renderer.gammaOutput = true;

                renderer.shadowMapEnabled = true;
                renderer.shadowMapCullFace = THREE.CullFaceBack;

                container.appendChild(renderer.domElement);

                // stats

                stats = new Stats();
                stats.domElement.style.position = 'absolute';
                stats.domElement.style.top = '0px';
                container.appendChild(stats.domElement);

                window.addEventListener('resize', onWindowResize, false);
            }
            
            function loadMesh() {
                var material = new THREE.MeshLambertMaterial({ambient: 0x555555, color: 0xAAAAFF});
                var loader = new THREE.STLLoader();
                loader.addEventListener('load', function(event) {
                    var geometry = event.content;
                    mesh = new THREE.Mesh(geometry, material);

                    mesh.rotation.set(-Math.PI / 2, 0, 0);
                    mesh.scale.set(.1, .1, .1);

                    mesh.castShadow = true;
                    mesh.receiveShadow = true;

                    scene.add(mesh);
                });
                loader.load('./earth.stl');
            }

            function addShadowedLight(x, y, z, color, intensity) {

                light = new THREE.DirectionalLight(color, intensity);
                light.position.set(x, y, z)
                scene.add(light);

                light.castShadow = true;
                light.shadowCameraVisible = true;

                var d = 2;
                light.shadowCameraLeft = -d;
                light.shadowCameraRight = d;
                light.shadowCameraTop = d;
                light.shadowCameraBottom = -d;

                light.shadowCameraNear = 1;
                light.shadowCameraFar = 4;

                light.shadowMapWidth = 1024;
                light.shadowMapHeight = 1024;

                light.shadowBias = -0.005;
                light.shadowDarkness = 0.15;
            }
            
            function onWindowResize() {

                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();

                renderer.setSize(window.innerWidth, window.innerHeight);
            }

            function animate() {

                requestAnimationFrame(animate);

                mesh.rotation.z += 0.01;

                renderer.render(scene, camera);
                
                stats.update();
            }

        </script>
    </body>
</html>
